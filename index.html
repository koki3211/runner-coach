<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#007AFF">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.svg">
  <link rel="apple-touch-icon" href="icon.svg">
  <title>Runner Coach</title>
  <link rel="stylesheet" href="design-tokens/variables.css">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html {
      font-family: var(--font-family-body);
      font-size: var(--font-size-body);
      color: var(--color-label-primary);
      background: var(--color-bg-grouped);
      -webkit-font-smoothing: antialiased;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: none;
    }
    body {
      padding-bottom: calc(var(--tab-bar-height) + var(--safe-area-bottom));
      min-height: 100dvh;
    }
    .screen { display: none; }
    .screen.active { display: block; }

    /* Nav Bar */
    .nav-bar {
      position: sticky; top: 0; z-index: 100;
      padding: calc(var(--safe-area-top) + var(--space-md)) var(--space-base) var(--space-md);
      background: var(--color-bg-primary);
      border-bottom: 0.5px solid var(--color-separator);
      display: flex; align-items: flex-start; justify-content: space-between;
    }
    .nav-bar-left { flex: 1; min-width: 0; }
    .nav-bar h1 {
      font-family: var(--font-family-display);
      font-size: var(--font-size-large-title);
      font-weight: var(--font-weight-bold);
      line-height: var(--line-height-tight);
    }
    .nav-bar .subtitle {
      font-size: var(--font-size-subhead);
      color: var(--color-label-secondary);
      margin-top: var(--space-2xs);
    }

    /* Global Avatar Button */
    .nav-avatar-btn {
      width: 36px; height: 36px; border-radius: 50%;
      border: none; cursor: pointer; flex-shrink: 0;
      margin-top: var(--space-xs); padding: 0;
      background: var(--color-fill-tertiary);
      display: flex; align-items: center; justify-content: center;
      overflow: hidden; transition: transform var(--duration-fast) var(--easing-spring);
    }
    .nav-avatar-btn:active { transform: scale(0.9); }
    .nav-avatar-btn img { width: 100%; height: 100%; object-fit: cover; }
    .nav-avatar-btn .avatar-initial {
      font-size: var(--font-size-subhead); font-weight: var(--font-weight-bold); color: #fff;
    }

    /* Account Popup */
    .account-popup-backdrop {
      position: fixed; inset: 0; z-index: 500; background: rgba(0,0,0,0.3);
      display: none; animation: fadeIn var(--duration-fast) var(--easing-default);
    }
    .account-popup-backdrop.show { display: block; }
    .account-popup {
      position: fixed; top: 60px; right: var(--space-base); z-index: 501;
      width: 280px; background: var(--color-bg-primary);
      border-radius: var(--radius-lg); box-shadow: var(--shadow-lg);
      padding: var(--space-lg); display: none;
      animation: slideDown var(--duration-normal) var(--easing-spring);
    }
    .account-popup.show { display: block; }
    @keyframes slideDown { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .account-popup-header {
      display: flex; align-items: center; gap: var(--space-md);
      padding-bottom: var(--space-md); border-bottom: 0.5px solid var(--color-separator);
    }
    .account-popup-avatar { width: 48px; height: 48px; border-radius: 50%; flex-shrink: 0; overflow: hidden; }
    .account-popup-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .account-popup-avatar-placeholder {
      width: 48px; height: 48px; border-radius: 50%; flex-shrink: 0;
      background: var(--color-brand-primary); color: #fff;
      display: flex; align-items: center; justify-content: center;
      font-size: var(--font-size-title3); font-weight: var(--font-weight-bold);
    }
    .account-popup-name { font-size: var(--font-size-subhead); font-weight: var(--font-weight-semibold); }
    .account-popup-email { font-size: var(--font-size-caption1); color: var(--color-label-secondary); margin-top: 2px; word-break: break-all; }
    .account-popup-id {
      display: flex; align-items: center; gap: var(--space-sm);
      padding: var(--space-md) 0; border-bottom: 0.5px solid var(--color-separator);
      font-size: var(--font-size-caption1); color: var(--color-label-secondary);
    }
    .account-popup-id .id-value {
      font-family: var(--font-family-data); font-weight: var(--font-weight-semibold);
      letter-spacing: 1.5px; color: var(--color-brand-primary);
      font-size: var(--font-size-footnote);
    }
    .account-popup-id .id-copy-small {
      margin-left: auto; padding: 2px 8px;
      font-size: var(--font-size-caption2); font-family: var(--font-family-body);
      border: 1px solid var(--color-separator-opaque); border-radius: var(--radius-sm);
      background: transparent; color: var(--color-label-secondary); cursor: pointer;
    }
    .account-popup-id .id-copy-small:active { opacity: 0.7; }
    .account-popup-actions { padding-top: var(--space-md); }
    .account-popup-logout {
      width: 100%; padding: var(--space-sm) var(--space-md);
      background: none; border: 1px solid var(--color-error); color: var(--color-error);
      border-radius: var(--radius-md); font-size: var(--font-size-subhead);
      font-weight: var(--font-weight-semibold); font-family: var(--font-family-body);
      cursor: pointer; transition: all var(--duration-fast);
    }
    .account-popup-logout:active { background: var(--color-error); color: #fff; }

    /* Login Screen */
    .login-screen {
      display: none; position: fixed; inset: 0; z-index: 600;
      background: var(--color-bg-grouped);
      flex-direction: column; align-items: center; justify-content: center;
      text-align: center; padding: var(--space-2xl);
    }
    .login-screen.show { display: flex; }
    .login-screen-icon { font-size: 72px; margin-bottom: var(--space-xl); }
    .login-screen-title {
      font-family: var(--font-family-display);
      font-size: var(--font-size-title1); font-weight: var(--font-weight-bold);
      margin-bottom: var(--space-sm);
    }
    .login-screen-desc {
      font-size: var(--font-size-body); color: var(--color-label-secondary);
      margin-bottom: var(--space-2xl); line-height: 1.6;
    }
    .login-screen .login-btn {
      display: inline-flex; align-items: center; gap: var(--space-sm);
      padding: var(--space-md) var(--space-2xl);
      background: var(--color-bg-primary); border: 1.5px solid var(--color-separator-opaque);
      border-radius: var(--radius-full); cursor: pointer;
      font-family: var(--font-family-body); font-size: var(--font-size-headline);
      font-weight: var(--font-weight-semibold); color: var(--color-label-primary);
    }
    .login-screen .login-btn:active { transform: scale(0.97); background: var(--color-fill-tertiary); }
    .login-screen-skip {
      margin-top: var(--space-lg); background: none; border: none;
      color: var(--color-label-tertiary); font-size: var(--font-size-footnote);
      font-family: var(--font-family-body); cursor: pointer;
    }

    /* Race countdown */
    .race-countdown {
      display: flex; align-items: center; justify-content: center; gap: var(--space-sm);
      margin: var(--space-base); padding: var(--space-md) var(--space-base);
      background: linear-gradient(135deg, rgba(255,59,48,0.08), rgba(255,149,0,0.08));
      border-radius: var(--radius-lg); border: 1px solid rgba(255,149,0,0.15);
    }
    .race-countdown-icon { font-size: 20px; }
    .race-countdown-text {
      font-size: var(--font-size-subhead); font-weight: var(--font-weight-semibold);
      color: var(--color-label-primary);
    }
    .race-countdown-days {
      font-family: var(--font-family-data); font-size: var(--font-size-title3);
      font-weight: var(--font-weight-bold); color: var(--color-interval);
    }

    /* Section & Card */
    .section { padding: var(--space-lg) var(--space-base); }
    .section-header {
      font-size: var(--font-size-title3);
      font-weight: var(--font-weight-semibold);
      margin-bottom: var(--space-md);
    }
    .card {
      background: var(--color-bg-primary);
      border-radius: var(--radius-lg);
      padding: var(--space-base);
      box-shadow: var(--shadow-card);
      margin-bottom: var(--space-md);
    }

    /* Today Hero */
    .today-hero {
      color: #fff; border-radius: var(--radius-xl);
      padding: var(--space-xl); margin: var(--space-base);
      position: relative; overflow: hidden;
    }
    .today-hero.type-jog { background: linear-gradient(135deg, #34C759, #248A3D); }
    .today-hero.type-interval { background: linear-gradient(135deg, #FF3B30, #C93400); }
    .today-hero.type-tempo { background: linear-gradient(135deg, #FF9500, #C93400); }
    .today-hero.type-long { background: linear-gradient(135deg, #007AFF, #5856D6); }
    .today-hero.type-rest { background: linear-gradient(135deg, #8E8E93, #636366); }
    .today-hero::after {
      content: ""; position: absolute; top: -30%; right: -20%;
      width: 200px; height: 200px; border-radius: 50%;
      background: rgba(255,255,255,0.08);
    }
    .today-hero .workout-type {
      font-size: var(--font-size-caption1); font-weight: var(--font-weight-semibold);
      text-transform: uppercase; letter-spacing: 1px; opacity: 0.85;
    }
    .today-hero .workout-name {
      font-family: var(--font-family-display);
      font-size: var(--font-size-title1); font-weight: var(--font-weight-bold);
      margin-top: var(--space-xs); line-height: var(--line-height-tight);
    }
    .today-hero .workout-detail {
      font-size: var(--font-size-subhead); opacity: 0.8; margin-top: var(--space-sm);
    }
    .today-hero .start-btn {
      display: inline-flex; align-items: center; gap: var(--space-sm);
      margin-top: var(--space-lg); padding: var(--space-md) var(--space-xl);
      background: rgba(255,255,255,0.22); backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.3); border-radius: var(--radius-full);
      color: #fff; font-family: var(--font-family-body);
      font-size: var(--font-size-headline); font-weight: var(--font-weight-semibold);
      cursor: pointer; transition: transform var(--duration-fast) var(--easing-spring);
    }
    .today-hero .start-btn:active { transform: scale(0.95); }
    .today-hero .start-btn.completed-btn {
      background: rgba(255,255,255,0.35); pointer-events: none;
    }

    /* Workout Steps */
    .workout-steps { list-style: none; }
    .workout-steps li {
      display: flex; align-items: center; gap: var(--space-md);
      padding: var(--space-md) 0; border-bottom: 0.5px solid var(--color-separator);
    }
    .workout-steps li:last-child { border-bottom: none; }
    .step-index {
      width: 28px; height: 28px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: var(--font-size-caption1); font-weight: var(--font-weight-semibold);
      color: #fff; flex-shrink: 0;
    }
    .step-info { flex: 1; }
    .step-info .step-label { font-size: var(--font-size-subhead); font-weight: var(--font-weight-medium); }
    .step-info .step-meta { font-size: var(--font-size-caption1); color: var(--color-label-secondary); margin-top: 2px; }
    .step-pace { font-family: var(--font-family-data); font-size: var(--font-size-subhead); color: var(--color-label-secondary); }

    /* Week Scroll */
    .week-scroll {
      display: flex; gap: var(--space-sm); overflow-x: auto;
      scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;
      padding: 0 var(--space-base) var(--space-sm); scrollbar-width: none;
    }
    .week-scroll::-webkit-scrollbar { display: none; }
    .day-card {
      flex: 0 0 72px; scroll-snap-align: start; text-align: center;
      padding: var(--space-md) var(--space-sm);
      background: var(--color-bg-primary); border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm); cursor: pointer;
      transition: transform var(--duration-fast) var(--easing-spring);
      position: relative;
    }
    .day-card:active { transform: scale(0.95); }
    .day-card.today { border: 2px solid var(--color-brand-primary); }
    .day-card.completed::after {
      content: ""; position: absolute; top: 6px; right: 6px;
      width: 8px; height: 8px; border-radius: 50%; background: var(--color-success);
    }
    .day-card .day-label {
      font-size: var(--font-size-caption2); color: var(--color-label-secondary);
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    .day-card .day-date { font-size: var(--font-size-title3); font-weight: var(--font-weight-semibold); margin: var(--space-xs) 0; }
    .day-card .day-type {
      font-size: 9px; font-weight: var(--font-weight-semibold);
      text-transform: uppercase; letter-spacing: 0.5px;
      padding: 2px 6px; border-radius: var(--radius-full);
      color: #fff; display: inline-block;
    }

    /* Progress Ring */
    .progress-section { display: flex; align-items: center; gap: var(--space-lg); padding: var(--space-base); }
    .progress-ring-wrap { position: relative; width: 80px; height: 80px; flex-shrink: 0; }
    .progress-ring { transform: rotate(-90deg); }
    .progress-ring-bg { fill: none; stroke: var(--color-fill-tertiary); stroke-width: 6; }
    .progress-ring-fill {
      fill: none; stroke: var(--color-brand-primary); stroke-width: 6;
      stroke-linecap: round; transition: stroke-dashoffset var(--duration-slow) var(--easing-default);
    }
    .progress-ring-text {
      position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
      font-family: var(--font-family-data); font-size: var(--font-size-title3); font-weight: var(--font-weight-bold);
    }
    .progress-info .progress-label { font-size: var(--font-size-headline); font-weight: var(--font-weight-semibold); }
    .progress-info .progress-detail { font-size: var(--font-size-footnote); color: var(--color-label-secondary); margin-top: var(--space-2xs); }

    /* Bar Chart */
    .bar-chart { display: flex; align-items: flex-end; gap: var(--space-sm); height: 100px; padding: var(--space-base) 0; }
    .bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: var(--space-xs); }
    .bar { width: 100%; max-width: 32px; border-radius: var(--radius-sm) var(--radius-sm) 0 0; transition: height var(--duration-normal) var(--easing-spring); }
    .bar-label { font-size: var(--font-size-caption2); color: var(--color-label-secondary); }
    .bar-value { font-family: var(--font-family-data); font-size: var(--font-size-caption2); color: var(--color-label-secondary); }

    /* Pace Grid */
    .pace-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-md);
    }
    .pace-item { text-align: center; }
    .pace-item .pace-label {
      font-size: var(--font-size-caption2); color: var(--color-label-secondary);
      text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: var(--space-2xs);
    }
    .pace-item .pace-value {
      font-family: var(--font-family-data); font-size: var(--font-size-headline);
      font-weight: var(--font-weight-semibold); color: var(--color-brand-primary);
    }

    /* Monthly Chart */
    .monthly-chart {
      display: flex; align-items: flex-end; gap: var(--space-md);
      height: 160px; padding: var(--space-base) 0;
    }
    .monthly-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: var(--space-xs); }
    .monthly-values { text-align: center; line-height: 1.2; }
    .monthly-val-done {
      font-family: var(--font-family-data); font-size: var(--font-size-caption1);
      font-weight: var(--font-weight-bold); color: var(--color-brand-primary);
    }
    .monthly-val-plan {
      font-family: var(--font-family-data); font-size: var(--font-size-caption2);
      color: var(--color-label-tertiary);
    }
    .monthly-bar-wrap {
      width: 100%; max-width: 40px; position: relative;
      border-radius: var(--radius-sm) var(--radius-sm) 0 0; overflow: hidden;
    }
    .monthly-bar-planned {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: var(--color-fill-tertiary); border-radius: var(--radius-sm) var(--radius-sm) 0 0;
    }
    .monthly-bar-done {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: var(--color-brand-primary); border-radius: var(--radius-sm) var(--radius-sm) 0 0;
      transition: height var(--duration-normal) var(--easing-spring);
    }
    .monthly-label { font-size: var(--font-size-caption2); color: var(--color-label-secondary); }
    .monthly-legend {
      display: flex; justify-content: center; gap: var(--space-lg);
      margin-top: var(--space-sm); font-size: var(--font-size-caption1); color: var(--color-label-secondary);
    }
    .legend-item { display: flex; align-items: center; gap: var(--space-xs); }
    .legend-dot {
      width: 10px; height: 10px; border-radius: 2px;
    }
    .legend-dot.done { background: var(--color-brand-primary); }
    .legend-dot.planned { background: var(--color-fill-tertiary); }

    /* Plan Screen */
    .plan-week { margin-bottom: var(--space-lg); }
    .plan-week-header {
      font-size: var(--font-size-footnote); font-weight: var(--font-weight-semibold);
      color: var(--color-label-secondary); text-transform: uppercase;
      letter-spacing: 0.5px; padding: 0 var(--space-base) var(--space-sm);
    }
    .plan-list { list-style: none; }
    .plan-item {
      display: flex; align-items: center; gap: var(--space-md);
      padding: var(--space-md) var(--space-base);
      background: var(--color-bg-primary);
      border-bottom: 0.5px solid var(--color-separator);
      cursor: pointer; transition: background var(--duration-fast);
    }
    .plan-item:first-child { border-radius: var(--radius-md) var(--radius-md) 0 0; }
    .plan-item:last-child { border-radius: 0 0 var(--radius-md) var(--radius-md); border-bottom: none; }
    .plan-item:active { background: var(--color-fill-tertiary); }
    .plan-item .plan-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .plan-item .plan-day { width: 32px; font-size: var(--font-size-footnote); color: var(--color-label-secondary); flex-shrink: 0; }
    .plan-item .plan-name { flex: 1; font-size: var(--font-size-caption1); font-weight: var(--font-weight-medium); display: flex; align-items: center; min-width: 0; }
    .plan-item .plan-name-text { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .plan-comment-badge {
      display: inline-flex; align-items: center; justify-content: center;
      margin-left: 6px; padding: 0 5px; height: 18px; min-width: 22px;
      background: var(--color-brand-primary); color: #fff;
      border-radius: 9px 9px 9px 3px;
      font-size: 10px; letter-spacing: 1px; flex-shrink: 0;
    }
    .plan-item .plan-dist { font-family: var(--font-family-data); font-size: var(--font-size-footnote); color: var(--color-label-secondary); }
    .plan-item .plan-actual {
      font-family: var(--font-family-data); font-size: var(--font-size-caption1);
      font-weight: var(--font-weight-semibold); color: var(--color-brand-primary);
      flex-shrink: 0; min-width: 36px; text-align: right;
    }
    .plan-item .plan-actual-empty { color: var(--color-label-tertiary); font-weight: var(--font-weight-regular); }
    .plan-item .plan-check {
      width: 22px; height: 22px; border-radius: 50%;
      border: 2px solid var(--color-fill-primary);
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; transition: all var(--duration-fast) var(--easing-spring); cursor: pointer;
    }
    .plan-item .plan-check.done { border-color: var(--color-success); background: var(--color-success); }
    .plan-item .plan-check.done::after { content: "\2713"; color: #fff; font-size: 12px; font-weight: var(--font-weight-bold); }

    /* Share */
    .share-preview {
      font-family: var(--font-family-data); font-size: var(--font-size-footnote);
      line-height: 1.6; color: var(--color-label-primary);
      white-space: pre-wrap; padding: var(--space-base);
    }
    .share-buttons {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: var(--space-sm); padding: 0 var(--space-base);
    }
    .share-btn {
      display: flex; align-items: center; justify-content: center; gap: var(--space-sm);
      padding: var(--space-md) var(--space-base);
      border-radius: var(--radius-md); border: none;
      font-size: var(--font-size-subhead); font-weight: var(--font-weight-semibold);
      font-family: var(--font-family-body);
      cursor: pointer; transition: opacity var(--duration-fast) ease;
    }
    .share-btn:active { opacity: 0.7; }
    .share-btn-line { background: #06C755; color: #fff; }
    .share-btn-x { background: #000; color: #fff; }
    .share-btn-copy { background: var(--color-fill-secondary); color: var(--color-label-primary); }
    .share-btn-other { background: var(--color-brand-primary); color: #fff; }

    /* Friends */
    .my-id-card {
      display: flex; align-items: center; gap: var(--space-md);
      padding: var(--space-base); margin: 0 var(--space-base);
    }
    .my-id-code {
      font-family: var(--font-family-data); font-size: var(--font-size-title2);
      font-weight: var(--font-weight-bold); letter-spacing: 2px; color: var(--color-brand-primary);
    }
    .my-id-actions { display: flex; gap: var(--space-sm); margin-left: auto; }
    .id-copy-btn {
      display: flex; align-items: center; gap: 4px; padding: var(--space-xs) var(--space-sm);
      font-size: var(--font-size-caption1); font-family: var(--font-family-body);
      border: 1px solid var(--color-separator-opaque); border-radius: var(--radius-sm);
      background: var(--color-bg-primary); color: var(--color-label-primary); cursor: pointer;
    }
    .id-copy-btn:active { opacity: 0.7; }
    .friend-card {
      display: flex; align-items: center; gap: var(--space-md);
      padding: var(--space-base); background: var(--color-bg-primary);
      border-radius: var(--radius-lg); box-shadow: var(--shadow-card);
      margin: 0 var(--space-base) var(--space-md);
    }
    .friend-avatar {
      width: 44px; height: 44px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px; flex-shrink: 0; color: #fff; font-weight: var(--font-weight-bold);
      object-fit: cover;
    }
    .friend-info { flex: 1; min-width: 0; }
    .friend-name { font-size: var(--font-size-subhead); font-weight: var(--font-weight-semibold); }
    .friend-goal { font-size: var(--font-size-caption1); color: var(--color-label-secondary); margin-top: 2px; }
    .friend-stats {
      display: flex; gap: var(--space-md); margin-top: var(--space-xs);
      font-size: var(--font-size-caption1); color: var(--color-label-secondary);
    }
    .friend-stats .stat-highlight {
      font-weight: var(--font-weight-bold); color: var(--color-brand-accent);
      font-family: var(--font-family-data);
    }
    .friend-week { display: flex; gap: 3px; margin-top: var(--space-sm); }
    .friend-week-dot { width: 8px; height: 8px; border-radius: 2px; background: var(--color-fill-tertiary); }
    .friend-week-dot.done { background: var(--color-success); }
    .friend-add-row {
      display: flex; gap: var(--space-sm); padding: 0 var(--space-base);
    }
    .login-btn {
      display: flex; align-items: center; justify-content: center; gap: var(--space-sm);
      width: 100%; padding: var(--space-md); margin: var(--space-base);
      border-radius: var(--radius-md); border: 1.5px solid var(--color-separator-opaque);
      background: var(--color-bg-primary); color: var(--color-label-primary);
      font-size: var(--font-size-subhead); font-weight: var(--font-weight-semibold);
      font-family: var(--font-family-body); cursor: pointer;
    }
    .login-btn:active { opacity: 0.7; }
    .pending-card {
      display: flex; align-items: center; gap: var(--space-md);
      padding: var(--space-sm) var(--space-base); background: var(--color-bg-primary);
      border-radius: var(--radius-lg); box-shadow: var(--shadow-card);
      margin: 0 var(--space-base) var(--space-sm);
    }
    .pending-card .friend-name { font-size: var(--font-size-footnote); }
    .accept-btn {
      padding: var(--space-xs) var(--space-md); border: none;
      background: var(--color-brand-primary); color: #fff;
      border-radius: var(--radius-sm); font-size: var(--font-size-caption1);
      font-weight: var(--font-weight-semibold); font-family: var(--font-family-body); cursor: pointer;
    }
    .decline-btn {
      padding: var(--space-xs) var(--space-sm); border: none;
      background: none; color: var(--color-label-secondary);
      font-size: var(--font-size-caption2); font-family: var(--font-family-body); cursor: pointer;
    }

    /* Goal Screen â€” Custom Form */
    .form-group { margin: 0 var(--space-base) var(--space-lg); }
    .form-label {
      display: block; font-size: var(--font-size-subhead); font-weight: var(--font-weight-semibold);
      color: var(--color-label-secondary); margin-bottom: var(--space-sm);
    }
    .form-input {
      width: 100%; padding: var(--space-md); font-size: var(--font-size-body);
      font-family: var(--font-family-body); color: var(--color-label-primary);
      background: var(--color-bg-primary); border: 1.5px solid var(--color-separator-opaque);
      border-radius: var(--radius-md); outline: none;
      transition: border-color var(--duration-fast);
    }
    .form-input:focus { border-color: var(--color-brand-primary); }
    .form-input::placeholder { color: var(--color-label-tertiary); }
    .form-toggle-group { display: flex; gap: var(--space-sm); }
    .form-toggle {
      flex: 1; padding: var(--space-md); text-align: center;
      font-size: var(--font-size-subhead); font-weight: var(--font-weight-semibold);
      font-family: var(--font-family-body);
      background: var(--color-bg-primary); border: 1.5px solid var(--color-separator-opaque);
      border-radius: var(--radius-md); cursor: pointer;
      color: var(--color-label-secondary);
      transition: all var(--duration-fast);
    }
    .form-toggle.active {
      border-color: var(--color-brand-primary); background: rgba(0,122,255,0.08);
      color: var(--color-brand-primary);
    }
    .time-input-group {
      display: flex; align-items: center; gap: var(--space-sm);
    }
    .time-input-group .time-input {
      width: 72px; text-align: center; flex: none;
      -moz-appearance: textfield;
    }
    .time-input-group .time-input::-webkit-outer-spin-button,
    .time-input-group .time-input::-webkit-inner-spin-button {
      -webkit-appearance: none; margin: 0;
    }
    .time-separator {
      font-size: var(--font-size-subhead); color: var(--color-label-secondary);
      font-weight: var(--font-weight-semibold);
    }
    .form-hint {
      font-size: var(--font-size-caption1); color: var(--color-brand-primary);
      margin-top: var(--space-sm); min-height: 1.6em; line-height: 1.4;
    }

    .cta-btn {
      display: block; width: calc(100% - var(--space-base) * 2);
      margin: var(--space-lg) auto; padding: var(--space-base);
      background: var(--color-brand-primary); color: #fff; border: none;
      border-radius: var(--radius-md); font-family: var(--font-family-body);
      font-size: var(--font-size-headline); font-weight: var(--font-weight-semibold);
      cursor: pointer; transition: transform var(--duration-fast) var(--easing-spring);
    }
    .cta-btn:active { transform: scale(0.97); }
    .cta-btn:disabled { opacity: 0.4; cursor: default; }

    /* Auth UI */
    .auth-area { padding: var(--space-base); }
    .auth-logged-in {
      display: flex; align-items: center; gap: var(--space-md);
      padding: var(--space-base); background: var(--color-bg-primary);
      border-radius: var(--radius-lg); box-shadow: var(--shadow-card);
    }
    .auth-avatar { width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0; }
    .auth-avatar-placeholder {
      width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0;
      background: var(--color-brand-primary); color: #fff;
      display: flex; align-items: center; justify-content: center;
      font-size: var(--font-size-headline); font-weight: var(--font-weight-bold);
    }
    .auth-info { flex: 1; }
    .auth-name { font-size: var(--font-size-subhead); font-weight: var(--font-weight-semibold); }
    .auth-link {
      font-size: var(--font-size-caption1); color: var(--color-brand-primary);
      background: none; border: none; cursor: pointer; font-family: var(--font-family-body);
      padding: 0; margin-top: 2px;
    }
    .auth-offline {
      font-size: var(--font-size-footnote); color: var(--color-label-tertiary);
      text-align: center; padding: var(--space-md);
    }
    .login-btn {
      display: inline-flex; align-items: center; gap: var(--space-sm);
      padding: var(--space-md) var(--space-xl);
      background: var(--color-bg-primary); border: 1.5px solid var(--color-separator-opaque);
      border-radius: var(--radius-full); cursor: pointer;
      font-family: var(--font-family-body); font-size: var(--font-size-subhead);
      font-weight: var(--font-weight-semibold); color: var(--color-label-primary);
      transition: all var(--duration-fast);
    }
    .login-btn:active { transform: scale(0.97); background: var(--color-fill-tertiary); }

    /* Completion Overlay */
    .completion-overlay {
      position: fixed; inset: 0; z-index: 1000; display: none;
      flex-direction: column; align-items: center; justify-content: center;
      background: var(--color-bg-primary); text-align: center; padding: var(--space-2xl);
    }
    .completion-overlay.show { display: flex; animation: fadeIn var(--duration-normal) var(--easing-default); }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .completion-icon {
      width: 120px; height: 120px; border-radius: 50%;
      background: linear-gradient(135deg, var(--color-success), #2fb851);
      display: flex; align-items: center; justify-content: center;
      font-size: 56px; color: #fff; margin-bottom: var(--space-xl);
      animation: popIn 0.5s var(--easing-spring) 0.2s both;
    }
    @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .completion-title {
      font-family: var(--font-family-display); font-size: var(--font-size-title1);
      font-weight: var(--font-weight-bold); animation: slideUp var(--duration-normal) var(--easing-default) 0.4s both;
    }
    .completion-subtitle {
      font-size: var(--font-size-callout); color: var(--color-label-secondary);
      margin-top: var(--space-sm); animation: slideUp var(--duration-normal) var(--easing-default) 0.5s both;
    }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .completion-stats {
      display: flex; gap: var(--space-2xl); margin-top: var(--space-2xl);
      animation: slideUp var(--duration-normal) var(--easing-default) 0.6s both;
    }
    .completion-stat { text-align: center; }
    .completion-stat .stat-value { font-family: var(--font-family-data); font-size: var(--font-size-title1); font-weight: var(--font-weight-bold); color: var(--color-brand-primary); }
    .completion-stat .stat-label { font-size: var(--font-size-caption1); color: var(--color-label-secondary); margin-top: var(--space-2xs); }
    .confetti-container { position: fixed; inset: 0; pointer-events: none; z-index: 1001; overflow: hidden; }
    .confetti {
      position: absolute; width: 8px; height: 8px; border-radius: 2px;
      top: -10px; animation: confettiFall linear forwards;
    }
    @keyframes confettiFall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
    .completion-close-btn {
      margin-top: var(--space-3xl); padding: var(--space-md) var(--space-3xl);
      background: var(--color-brand-primary); color: #fff; border: none;
      border-radius: var(--radius-full); font-family: var(--font-family-body);
      font-size: var(--font-size-headline); font-weight: var(--font-weight-semibold);
      cursor: pointer; transition: transform var(--duration-fast) var(--easing-spring);
      animation: slideUp var(--duration-normal) var(--easing-default) 0.7s both;
    }
    .completion-close-btn:active { transform: scale(0.95); }

    /* Tab Bar */
    .tab-bar {
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 200;
      display: flex; justify-content: space-around; align-items: flex-start;
      padding: var(--space-sm) 0 calc(var(--space-sm) + var(--safe-area-bottom));
      background: var(--color-bg-elevated);
      border-top: 0.5px solid var(--color-separator);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    }
    .tab-item {
      display: flex; flex-direction: column; align-items: center; gap: 2px;
      padding: var(--space-xs) var(--space-md); border: none; background: none;
      cursor: pointer; color: var(--color-label-tertiary);
      font-family: var(--font-family-body); font-size: var(--font-size-caption2);
      font-weight: var(--font-weight-medium); transition: color var(--duration-fast);
    }
    .tab-item.active { color: var(--color-brand-primary); }
    .tab-item svg { width: 24px; height: 24px; fill: currentColor; }

    /* Empty state */
    .empty-state {
      text-align: center; padding: var(--space-4xl) var(--space-2xl);
      color: var(--color-label-secondary);
    }
    .empty-state .empty-icon { font-size: 48px; margin-bottom: var(--space-base); }
    .empty-state .empty-text { font-size: var(--font-size-callout); }
    .empty-state .empty-btn {
      margin-top: var(--space-lg); padding: var(--space-md) var(--space-xl);
      background: var(--color-brand-primary); color: #fff; border: none;
      border-radius: var(--radius-full); font-size: var(--font-size-subhead);
      font-weight: var(--font-weight-semibold); font-family: var(--font-family-body);
      cursor: pointer;
    }

    /* My ID Card */
    .my-id-card {
      text-align: center; padding: var(--space-lg) var(--space-base);
    }
    .my-id-code {
      font-family: var(--font-family-data); font-size: var(--font-size-title1);
      font-weight: var(--font-weight-bold); letter-spacing: 3px;
      color: var(--color-brand-primary); margin-bottom: var(--space-md);
    }
    .my-id-actions {
      display: flex; gap: var(--space-sm); justify-content: center;
    }
    .id-copy-btn {
      display: inline-flex; align-items: center; gap: var(--space-xs);
      padding: var(--space-sm) var(--space-base);
      background: var(--color-fill-tertiary); border: none;
      border-radius: var(--radius-full); cursor: pointer;
      font-family: var(--font-family-body); font-size: var(--font-size-caption1);
      font-weight: var(--font-weight-semibold); color: var(--color-label-primary);
      transition: transform var(--duration-fast) var(--easing-spring);
    }
    .id-copy-btn:active { transform: scale(0.95); }
    .id-copy-btn.line-btn {
      background: #06C755; color: #fff;
    }

    /* Plan date column */
    .plan-item .plan-date {
      width: 42px; font-size: var(--font-size-caption1);
      font-family: var(--font-family-data);
      color: var(--color-label-tertiary); flex-shrink: 0;
    }
    .plan-item-race {
      background: linear-gradient(135deg, rgba(255,59,48,0.06), rgba(255,149,0,0.06)) !important;
    }
    .plan-race-label {
      color: var(--color-interval) !important;
      font-weight: var(--font-weight-bold) !important;
      font-size: var(--font-size-headline) !important;
    }

    /* Edit Workout Overlay */
    .edit-overlay {
      position: fixed; inset: 0; z-index: 900; display: none;
    }
    .edit-overlay.show { display: block; }
    .edit-backdrop {
      position: absolute; inset: 0; background: rgba(0,0,0,0.4);
      animation: fadeIn var(--duration-fast) var(--easing-default);
    }
    .edit-sheet {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: var(--color-bg-primary);
      border-radius: var(--radius-xl) var(--radius-xl) 0 0;
      padding: var(--space-md) var(--space-base) calc(var(--space-2xl) + var(--safe-area-bottom));
      animation: slideSheetUp var(--duration-normal) var(--easing-spring);
    }
    @keyframes slideSheetUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .edit-sheet-handle {
      width: 36px; height: 4px; border-radius: 2px;
      background: var(--color-fill-primary); margin: 0 auto var(--space-base);
    }
    .edit-sheet-title {
      font-size: var(--font-size-headline); font-weight: var(--font-weight-semibold);
      text-align: center; margin-bottom: var(--space-lg);
    }
    .edit-field { margin-bottom: var(--space-lg); }
    .edit-field .form-label { margin-bottom: var(--space-sm); }
    .edit-dist-duration-row {
      display: flex; align-items: center; gap: var(--space-xs);
    }
    .edit-dist-duration-row .form-input {
      flex: 1; min-width: 0; text-align: center;
    }
    .edit-unit-label {
      font-size: var(--font-size-subhead); color: var(--color-label-secondary);
      white-space: nowrap; flex-shrink: 0;
    }
    .edit-select {
      -webkit-appearance: none; appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238E8E93' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 12px center;
      padding-right: 36px;
    }
    .edit-actions {
      display: flex; gap: var(--space-md); margin-top: var(--space-lg);
    }
    .edit-cancel-btn {
      flex: 1; padding: var(--space-base);
      background: var(--color-fill-tertiary); color: var(--color-label-primary);
      border: none; border-radius: var(--radius-md);
      font-family: var(--font-family-body); font-size: var(--font-size-headline);
      font-weight: var(--font-weight-semibold); cursor: pointer;
      transition: transform var(--duration-fast) var(--easing-spring);
    }
    .edit-cancel-btn:active { transform: scale(0.97); }
    .edit-save-btn {
      flex: 1; width: auto; margin: 0;
    }

    /* Small Button */
    .small-btn {
      padding: var(--space-xs) var(--space-md); border: 1px solid var(--color-separator-opaque);
      background: var(--color-bg-primary); color: var(--color-label-primary);
      border-radius: var(--radius-sm); font-size: var(--font-size-caption1);
      font-weight: var(--font-weight-semibold); font-family: var(--font-family-body); cursor: pointer;
    }
    .small-btn:active { opacity: 0.7; }
    .small-btn.primary { background: var(--color-brand-primary); color: #fff; border-color: var(--color-brand-primary); }
    .small-btn.danger { background: none; color: var(--color-error); border-color: var(--color-error); }

    /* Friend Details */
    .friend-today { font-size: var(--font-size-caption1); color: var(--color-label-secondary); margin-top: 2px; }
    .done-badge {
      display: inline-block; padding: 1px 6px; margin-left: var(--space-xs);
      background: var(--color-success); color: #fff; border-radius: var(--radius-full);
      font-size: var(--font-size-caption2); font-weight: var(--font-weight-bold);
    }
    .friend-streak {
      text-align: center; flex-shrink: 0; min-width: 44px;
    }
    .streak-num {
      font-family: var(--font-family-data); font-size: var(--font-size-title2);
      font-weight: var(--font-weight-bold); color: var(--color-brand-primary);
    }
    .streak-label {
      font-size: var(--font-size-caption2); color: var(--color-label-secondary);
    }

    /* Friend Plan Overlay */
    .friend-plan-overlay {
      position: fixed; inset: 0; z-index: 800;
      background: var(--color-bg-grouped);
      display: none; flex-direction: column;
    }
    .friend-plan-overlay.show { display: flex; animation: fadeIn var(--duration-normal) var(--easing-default); }
    .friend-plan-header {
      position: relative; z-index: 10;
      background: var(--color-bg-primary);
      padding: var(--safe-area-top) var(--space-base) var(--space-md);
      border-bottom: 0.5px solid var(--color-separator);
      text-align: center;
    }
    .friend-plan-header-row {
      display: flex; justify-content: flex-end;
      padding-top: var(--space-md); padding-bottom: var(--space-sm);
    }
    .friend-plan-close {
      width: 32px; height: 32px; border-radius: 50%;
      background: var(--color-fill-tertiary); border: none;
      font-size: 16px; cursor: pointer; display: flex;
      align-items: center; justify-content: center;
      color: var(--color-label-secondary);
    }
    .friend-plan-close:active { opacity: 0.7; }
    .friend-plan-name {
      font-size: var(--font-size-title3); font-weight: var(--font-weight-bold);
    }
    .friend-plan-subtitle {
      font-size: var(--font-size-subhead); color: var(--color-label-secondary);
      margin-top: var(--space-xs);
    }
    .friend-plan-body {
      flex: 1; overflow-y: auto;
      padding-bottom: calc(var(--space-4xl) + var(--safe-area-bottom));
    }
    .friend-plan-today {
      background: rgba(0, 122, 255, 0.06) !important;
      border-left: 3px solid var(--color-brand-primary);
    }

    /* Account Card (top section of Team tab) */
    .account-card {
      background: linear-gradient(180deg, rgba(0,122,255,0.04) 0%, var(--color-bg-primary) 100%);
    }
    .my-id-row {
      display: flex; align-items: center; gap: var(--space-sm);
      padding-top: var(--space-sm); margin-top: var(--space-sm);
      border-top: 0.5px solid var(--color-separator);
      font-size: var(--font-size-caption1); color: var(--color-label-secondary);
    }
    .my-id-row .my-id-value {
      font-family: var(--font-family-data); font-weight: var(--font-weight-semibold);
      letter-spacing: 1.5px; color: var(--color-brand-primary);
      font-size: var(--font-size-footnote); cursor: pointer;
    }
    .my-id-row .my-id-value:active { opacity: 0.7; }
    .my-id-row .my-id-copy {
      margin-left: auto; padding: 2px 8px;
      font-size: var(--font-size-caption2); font-family: var(--font-family-body);
      font-weight: var(--font-weight-medium);
      border: 1px solid var(--color-separator-opaque); border-radius: var(--radius-sm);
      background: transparent; color: var(--color-label-secondary); cursor: pointer;
    }
    .my-id-row .my-id-copy:active { opacity: 0.7; }

    /* Workout Comment in Hero */
    .workout-comment {
      margin-top: var(--space-sm); padding: var(--space-sm) var(--space-md);
      background: rgba(255,255,255,0.12); border-radius: var(--radius-sm);
      font-size: var(--font-size-footnote); line-height: 1.5; opacity: 0.9;
    }

    /* Plan Type Tabs (Run / Strength) */
    .plan-type-tabs {
      display: flex; gap: 0; margin: var(--space-base);
      background: var(--color-fill-tertiary); border-radius: var(--radius-md); padding: 3px;
    }
    .plan-type-tab {
      flex: 1; padding: var(--space-sm) var(--space-base);
      text-align: center; border: none; background: none; cursor: pointer;
      font-family: var(--font-family-body); font-size: var(--font-size-subhead);
      font-weight: var(--font-weight-semibold); color: var(--color-label-secondary);
      border-radius: calc(var(--radius-md) - 2px);
      transition: all var(--duration-fast) var(--easing-default);
    }
    .plan-type-tab.active {
      background: var(--color-bg-primary); color: var(--color-label-primary);
      box-shadow: var(--shadow-sm);
    }

    /* Strength Training Items */
    .strength-day {
      display: flex; align-items: center; gap: var(--space-md);
      padding: var(--space-md) var(--space-base);
      background: var(--color-bg-primary);
      border-bottom: 0.5px solid var(--color-separator);
    }
    .strength-day:first-child { border-radius: var(--radius-md) var(--radius-md) 0 0; }
    .strength-day:last-child { border-radius: 0 0 var(--radius-md) var(--radius-md); border-bottom: none; }
    .strength-day-label {
      width: 56px; flex-shrink: 0;
      font-size: var(--font-size-caption1); color: var(--color-label-secondary);
    }
    .strength-day-label .strength-day-name { font-weight: var(--font-weight-semibold); }
    .strength-day-label .strength-day-date { font-size: var(--font-size-caption2); }
    .strength-exercises { flex: 1; min-width: 0; }
    .strength-exercise-row {
      display: flex; align-items: center; gap: var(--space-sm);
      padding: 3px 0;
    }
    .strength-exercise-check {
      width: 20px; height: 20px; border-radius: 4px;
      border: 2px solid var(--color-fill-primary);
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; cursor: pointer;
      transition: all var(--duration-fast) var(--easing-spring);
    }
    .strength-exercise-check.done { border-color: var(--color-success); background: var(--color-success); }
    .strength-exercise-check.done::after { content: "\2713"; color: #fff; font-size: 11px; font-weight: var(--font-weight-bold); }
    .strength-exercise-name {
      flex: 1; font-size: var(--font-size-footnote);
      background: none; border: none; outline: none;
      font-family: var(--font-family-body); color: var(--color-label-primary);
      padding: 2px 0;
    }
    .strength-exercise-name::placeholder { color: var(--color-label-tertiary); }
    .strength-add-btn {
      font-size: var(--font-size-caption1); color: var(--color-brand-primary);
      background: none; border: none; cursor: pointer; padding: 2px 0;
      font-family: var(--font-family-body); font-weight: var(--font-weight-semibold);
    }
    .strength-add-btn:active { opacity: 0.7; }
    .strength-remove-btn {
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--color-fill-tertiary); border: none;
      color: var(--color-label-tertiary); font-size: 12px;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .strength-remove-btn:active { opacity: 0.7; }

    /* Today Strength Training Section */
    .today-strength {
      margin: var(--space-base); padding: var(--space-base);
      background: var(--color-bg-primary); border-radius: var(--radius-lg);
      box-shadow: var(--shadow-card);
    }
    .today-strength-header {
      display: flex; align-items: center; gap: var(--space-sm);
      font-size: var(--font-size-headline); font-weight: var(--font-weight-semibold);
      margin-bottom: var(--space-md);
    }
    .today-strength-rest {
      text-align: center; padding: var(--space-md);
      color: var(--color-label-secondary); font-size: var(--font-size-subhead);
    }

    /* Active Workout Button */
    .start-btn.active-btn {
      background: var(--color-success);
      animation: activeGlow 2s ease-in-out infinite;
    }
    .active-pulse {
      display: inline-block; width: 8px; height: 8px;
      border-radius: 50%; background: #fff;
      margin-right: var(--space-sm);
      animation: pulse 1.5s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.7); }
    }
    @keyframes activeGlow {
      0%, 100% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(52, 199, 89, 0); }
    }

    /* Friend Active Status */
    .friend-active-status {
      display: inline-flex; align-items: center; gap: 4px;
      color: var(--color-success); font-weight: var(--font-weight-semibold);
    }
    .active-dot {
      display: inline-block; width: 6px; height: 6px;
      border-radius: 50%; background: var(--color-success);
      animation: pulse 1.5s ease-in-out infinite;
    }
    .active-elapsed {
      font-weight: var(--font-weight-regular);
      font-size: var(--font-size-caption2);
      color: var(--color-label-secondary);
    }

    /* Training Friends Mini Cards (Today tab) */
    .training-friends-banner {
      padding: var(--space-sm) var(--space-base);
    }
    .training-friend-mini {
      display: flex; align-items: center; gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      background: linear-gradient(135deg, rgba(52,199,89,0.08), rgba(0,122,255,0.06));
      border: 1px solid rgba(52,199,89,0.2);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-xs);
    }
    .training-friend-pulse {
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--color-success); flex-shrink: 0;
      animation: pulse 1.5s ease-in-out infinite;
    }
    .training-friend-avatar {
      width: 32px; height: 32px; border-radius: 50%;
      object-fit: cover; flex-shrink: 0;
    }
    .training-friend-avatar-placeholder {
      width: 32px; height: 32px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-weight: var(--font-weight-bold);
      font-size: var(--font-size-caption1); flex-shrink: 0;
    }
    .training-friend-body { flex: 1; min-width: 0; }
    .training-friend-name {
      font-size: var(--font-size-footnote);
      font-weight: var(--font-weight-semibold);
    }
    .training-friend-detail {
      font-size: var(--font-size-caption1);
      color: var(--color-success);
      font-weight: var(--font-weight-semibold);
    }

    /* Active Friend Card Highlight (Team tab) */
    .friend-card.friend-active {
      border: 1.5px solid var(--color-success);
      box-shadow: 0 0 0 3px rgba(52,199,89,0.12), var(--shadow-card);
    }
    .friend-active-badge {
      display: inline-flex; align-items: center; gap: 3px;
      padding: 1px 6px; margin-left: 6px;
      background: var(--color-success); color: #fff;
      border-radius: var(--radius-full);
      font-size: var(--font-size-caption2); font-weight: var(--font-weight-bold);
      vertical-align: middle;
    }

    /* Friend ID display */
    .friend-id-display {
      font-family: var(--font-family-data);
      font-size: var(--font-size-caption2);
      color: var(--color-label-primary);
      letter-spacing: 0.5px;
      font-weight: var(--font-weight-semibold);
    }

    /* Manako Toggle */
    .manako-toggle {
      display: flex; align-items: center; gap: var(--space-sm);
      cursor: pointer; padding: var(--space-sm) 0;
    }
    .manako-toggle input[type="checkbox"] {
      width: 20px; height: 20px; accent-color: var(--color-brand-primary);
    }
    .manako-toggle-label {
      font-size: var(--font-size-body);
      font-weight: var(--font-weight-semibold);
    }

    /* Key Workout Marker (Plan tab) */
    .plan-item.key-workout .plan-name-text {
      font-weight: var(--font-weight-bold);
      color: var(--color-interval);
    }

    /* Utility */
    .mx { margin-left: var(--space-base); margin-right: var(--space-base); }

    /* Day Schedule Selector */
    .day-schedule { margin: 0 var(--space-base) var(--space-lg); }
    .day-schedule-row {
      display: flex; align-items: center; gap: var(--space-sm);
      padding: var(--space-sm) 0;
      border-bottom: 0.5px solid var(--color-separator);
    }
    .day-schedule-row:last-child { border-bottom: none; }
    .day-schedule-label {
      width: 28px; font-size: var(--font-size-subhead);
      font-weight: var(--font-weight-semibold); flex-shrink: 0;
    }
    .day-schedule-select {
      flex: 1; padding: var(--space-sm) var(--space-md);
      font-size: var(--font-size-footnote); font-family: var(--font-family-body);
      color: var(--color-label-primary); background: var(--color-bg-primary);
      border: 1px solid var(--color-separator-opaque);
      border-radius: var(--radius-sm); outline: none;
      -webkit-appearance: none; appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%238E8E93' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 8px center;
      padding-right: 24px;
    }
    .day-schedule-dot {
      width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
    }
    .text-secondary { color: var(--color-label-secondary); }
    .text-sm { font-size: var(--font-size-footnote); }
    .mt-sm { margin-top: var(--space-sm); }
    .mt-md { margin-top: var(--space-md); }
    .mt-lg { margin-top: var(--space-lg); }
  </style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen" class="login-screen">
  <div class="login-screen-icon">ðŸƒ</div>
  <div class="login-screen-title">Runner Coach</div>
  <div class="login-screen-desc">ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã®ç›®æ¨™é”æˆã‚’<br>ä»²é–“ã¨ä¸€ç·’ã«ã‚µãƒãƒ¼ãƒˆ</div>
  <button class="login-btn" onclick="Social.login()">
    <svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
    Googleã§ãƒ­ã‚°ã‚¤ãƒ³
  </button>
  <button class="login-screen-skip" onclick="App.skipLogin()">ãƒ­ã‚°ã‚¤ãƒ³ã›ãšã«å§‹ã‚ã‚‹</button>
</div>

<!-- ACCOUNT POPUP -->
<div id="account-popup-backdrop" class="account-popup-backdrop" onclick="App.closeAccountPopup()"></div>
<div id="account-popup" class="account-popup"></div>

<!-- SCREEN: TODAY -->
<div id="screen-today" class="screen active">
  <div class="nav-bar">
    <div class="nav-bar-left">
      <h1>Today</h1>
      <div class="subtitle" id="today-subtitle">ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ã¦ãã ã•ã„</div>
    </div>
    <button class="nav-avatar-btn" id="avatar-btn-today" onclick="App.toggleAccountPopup()"></button>
  </div>
  <div id="today-content"></div>
</div>

<!-- SCREEN: PLAN -->
<div id="screen-plan" class="screen">
  <div class="nav-bar">
    <div class="nav-bar-left">
      <h1>ãƒ—ãƒ©ãƒ³</h1>
      <div class="subtitle" id="plan-subtitle"></div>
    </div>
    <button class="nav-avatar-btn" id="avatar-btn-plan" onclick="App.toggleAccountPopup()"></button>
  </div>
  <div id="plan-content"></div>
</div>

<!-- SCREEN: TEAM -->
<div id="screen-friends" class="screen">
  <div class="nav-bar">
    <div class="nav-bar-left">
      <h1>Team</h1>
      <div class="subtitle">ä»²é–“ã¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å…±æœ‰</div>
    </div>
    <button class="nav-avatar-btn" id="avatar-btn-friends" onclick="App.toggleAccountPopup()"></button>
  </div>
  <div id="friends-content"></div>
  <div id="share-content"></div>
</div>

<!-- SCREEN: GOAL -->
<div id="screen-goal" class="screen">
  <div class="nav-bar">
    <div class="nav-bar-left">
      <h1>ç›®æ¨™è¨­å®š</h1>
      <div class="subtitle">å¤§ä¼šã¨ç›®æ¨™ã‚¿ã‚¤ãƒ ã‚’å…¥åŠ›</div>
    </div>
    <button class="nav-avatar-btn" id="avatar-btn-goal" onclick="App.toggleAccountPopup()"></button>
  </div>
  <div class="section">
    <div class="section-header">ã‚ãªãŸã®ç›®æ¨™</div>
    <div id="goal-form-area">
      <form id="goal-form" onsubmit="event.preventDefault()">
        <div class="form-group">
          <label class="form-label">å¤§ä¼šå</label>
          <input type="text" id="input-race-name" class="form-input" placeholder="ä¾‹: æ±äº¬ãƒžãƒ©ã‚½ãƒ³ 2026">
        </div>
        <div class="form-group">
          <label class="form-label">å¤§ä¼šæ—¥</label>
          <input type="date" id="input-race-date" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">ç¨®ç›®</label>
          <div class="form-toggle-group">
            <button type="button" class="segment form-toggle active" data-value="full" onclick="App.selectRaceType(this)">ãƒ•ãƒ«ãƒžãƒ©ã‚½ãƒ³</button>
            <button type="button" class="segment form-toggle" data-value="half" onclick="App.selectRaceType(this)">ãƒãƒ¼ãƒ•ãƒžãƒ©ã‚½ãƒ³</button>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">ç›®æ¨™ã‚¿ã‚¤ãƒ </label>
          <div class="time-input-group">
            <input type="number" id="input-time-h" class="form-input time-input" value="4" min="1" max="9">
            <span class="time-separator">æ™‚é–“</span>
            <input type="number" id="input-time-m" class="form-input time-input" value="00" min="0" max="59">
            <span class="time-separator">åˆ†</span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">æ›œæ—¥åˆ¥ãƒ¡ãƒ‹ãƒ¥ãƒ¼</label>
          <div class="form-hint" style="margin-bottom:var(--space-sm)">èµ°ã‚‹æ›œæ—¥ã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¨­å®š</div>
          <div class="day-schedule" id="day-schedule"></div>
        </div>
        <div class="form-group">
          <label class="manako-toggle">
            <input type="checkbox" id="input-manako">
            <span class="manako-toggle-label">çœŸåå­å¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é©ç”¨</span>
          </label>
          <div class="form-hint">å¤§æ±æ–‡åŒ–å¤§å­¦ã‚³ãƒ¼ãƒç›£ä¿®ã®ãƒ¬ãƒ¼ã‚¹ç›´å‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼<br>ï¼ˆãƒ•ãƒ«: 42æ—¥å‰ã€œ / ãƒãƒ¼ãƒ•: 15æ—¥å‰ã€œï¼‰</div>
        </div>
      </form>
    </div>
  </div>
  <button class="cta-btn" id="generate-btn" onclick="App.generatePlan()">ãƒ—ãƒ©ãƒ³ã‚’è‡ªå‹•ä½œæˆ</button>
  <div class="text-sm text-secondary" style="text-align:center;padding-bottom:var(--space-lg)">ç›®æ¨™ã‚¿ã‚¤ãƒ ã‹ã‚‰ãƒšãƒ¼ã‚¹ã‚’è‡ªå‹•ç®—å‡ºã—ã¾ã™</div>
</div>

<!-- EDIT WORKOUT OVERLAY -->
<div id="edit-overlay" class="edit-overlay"></div>

<!-- FRIEND PLAN OVERLAY -->
<div id="friend-plan-overlay" class="friend-plan-overlay"></div>

<!-- COMPLETION OVERLAY -->
<div id="completion-overlay" class="completion-overlay">
  <div class="confetti-container" id="confetti-container"></div>
  <div class="completion-icon">&#x2714;</div>
  <div class="completion-title">ãƒŠã‚¤ã‚¹ãƒ©ãƒ³!</div>
  <div class="completion-subtitle" id="completion-subtitle"></div>
  <div class="completion-stats" id="completion-stats"></div>
  <button class="completion-close-btn" onclick="App.hideCompletion()">é–‰ã˜ã‚‹</button>
</div>

<!-- TAB BAR -->
<nav class="tab-bar">
  <button class="tab-item active" data-tab="today" onclick="App.switchTab('today',this)">
    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
    Today
  </button>
  <button class="tab-item" data-tab="plan" onclick="App.switchTab('plan',this)">
    <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
    Plan
  </button>
  <button class="tab-item" data-tab="friends" onclick="App.switchTab('friends',this)">
    <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
    Team
  </button>
  <button class="tab-item" data-tab="goal" onclick="App.switchTab('goal',this)">
    <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.488.488 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
    Goal
  </button>
</nav>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script src="social.js"></script>
<script src="app.js"></script>
</body>
</html>
